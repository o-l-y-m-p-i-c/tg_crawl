<html lang="en">
  <head>
    <meta charset="UTF-8" />

    <script src="{{ url_for('static', filename='components/vis/dist/vis.js') }}"></script>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='components/vis/dist/vis.css') }}"
    />

    <script
      type="text/javascript"
      src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"
    ></script>

    <script
      crossorigin
      src="https://cdnjs.cloudflare.com/ajax/libs/react/16.8.6/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/16.8.6/umd/react-dom.development.js"
    ></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles.css') }}"
    />

    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap"
      rel="stylesheet"
    />
    <title>Telegram Graph</title>
    <style>
      dialog ~ .overlay {
        display: none !important;
      }
      dialog[open] ~ .overlay {
        display: block !important;
      }
    </style>
  </head>
  <body style="margin: 0; overflow: hidden">
    <canvas class="canvas-background"></canvas>
    <div id="root"></div>
    <div id="graph"></div>

    <div class="wrap" style="transition: all 0.3s ease-out">
      <div class="">
        <button style="width: 100%" class="toggle-button">
          <span class="toggle-button__label title"> Details </span>
          <span class="toggle-button__icon">
            <svg
              width="15"
              height="10"
              viewBox="0 0 20 15"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M1.00057 14.9732H19.0006C19.1828 14.9727 19.3614 14.9224 19.5173 14.8279C19.6731 14.7333 19.8001 14.5981 19.8848 14.4367C19.9694 14.2753 20.0085 14.0939 19.9977 13.912C19.9869 13.73 19.9267 13.5545 19.8236 13.4042L10.8236 0.40425C10.4506 -0.13475 9.55257 -0.13475 9.17857 0.40425L0.178574 13.4042C0.0743986 13.5542 0.0133079 13.7298 0.00193892 13.912C-0.00943004 14.0943 0.0293576 14.2761 0.114088 14.4379C0.198818 14.5996 0.32625 14.735 0.482538 14.8294C0.638826 14.9238 0.817994 14.9735 1.00057 14.9732Z"
                fill="currentColor"
              />
            </svg>
          </span>
        </button>
      </div>
      <div
        class=""
        style="padding: 10px; flex: 1; display: flex; flex-direction: column"
      >
        <!-- <div class="toggle-container"> -->
        <!-- <div class="toggle-content"> -->
        <div class="">
          <span class="title"> Start date time: </span> <i id="date-time"></i>
        </div>
        <div class="">
          <span class="title"> Depth: </span> <i id="depth"></i>
        </div>
        <!-- <div>
        <span class="title">
            Keywords:
        </span> $PEPE, $BRETT, $ANDY, $LANDWOLF,
        $TURBO, $MYRO, $HOPPY, $WIF,
        $MANEKI, $FOXY, $MAGA, $LFGO, $POLA
    </div> -->
        <div class="">
          <span class="title"> Node list: </span>
          <i id="node-count-left">0</i>/<i id="node-count-right">0</i>
        </div>

        <div class="node-list__wrap">
          <!-- fdsfsdfsdsdg-sdg-dsg-sd-gsdgsdgsdgfdsfsdfsdsdg-sdg-dsg-sd-gsdgsdgsdgfdsfsdfsdsdg-sdg-dsg-sd-gsdgsdgsdgfdsfsdfsdsdg-sdg-dsg-sd-gsdgsdgsdgfdsfsdfsdsdg-sdg-dsg-sd-gsdgsdgsdgfdsfsdfsdsdg-sdg-dsg-sd-gsdgsdgsdgfdsfsdfsdsdg-sdg-dsg-sd-gsdgsdgsdgfdsfsdfsdsdg-sdg-dsg-sd-gsdgsdgsdgfdsfsdfsdsdg-sdg-dsg-sd-gsdgsdgsdgfdsfsdfsdsdg-sdg-dsg-sd-gsdgsdgsdgfdsfsdfsdsdg-sdg-dsg-sd-gsdgsdgsdgfdsfsdfsdsdg-sdg-dsg-sd-gsdgsdgsdgfdsfsdfsdsdg-sdg-dsg-sd-gsdgsdgsdgfdsfsdfsdsdg-sdg-dsg-sd-gsdgsdgsdgfdsfsdfsdsdg-sdg-dsg-sd-gsdgsdgsdgfdsfsdfsdsdg-sdg-dsg-sd-gsdgsdgsdgfdsfsdfsdsdg-sdg-dsg-sd-gsdgsdgsdgfdsfsdfsdsdg-sdg-dsg-sd-gsdgsdgsdgfdsfsdfsdsdg-sdg-dsg-sd-gsdgsdgsdgfdsfsdfsdsdg-sdg-dsg-sd-gsdgsdgsdgfdsfsdfsdsdg-sdg-dsg-sd-gsdgsdgsdgfdsfsdfsdsdg-sdg-dsg-sd-gsdgsdgsdgfdsfsdfsdsdg-sdg-dsg-sd-gsdgsdgsdgfdsfsdfsdsdg-sdg-dsg-sd-gsdgsdgsdgfdsfsdfsdsdg-sdg-dsg-sd-gsdgsdgsdg -->
          <ul id="node-list"></ul>
        </div>
        <!-- </div> -->
        <!-- </div> -->
      </div>
    </div>

    <dialog id="favDialog" style="z-index: 2">
      <form method="dialog">
        <section>
          <h3 style="max-width: 90%; margin-left: auto; margin-right: auto">
            You will be transferred to this channel
          </h3>
          <!-- <div class="" style="display: flex; justify-content: center"> -->
          <h4 id="tg_name">NAME</h4>
          <!-- </div> -->
        </section>
        <menu>
          <button id="cancel" class="button-1 close-btn" type="reset">
            Close
          </button>
          <a id="open" href="#" target="_blank" class="button-1 open-btn"
            >Open</a
          >
        </menu>
      </form>
    </dialog>
    <div
      class="overlay"
      style="
        position: absolute;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: #8d8d8d6b;
      "
    ></div>
    <script
      type="module"
      src="{{ url_for('static', filename='index.js') }}"
    ></script>

    <script>
      const cancel = document.querySelector("#cancel");
      // const open = document.querySelector("#open");

      cancel.onclick = (e) => {
        e.target.closest("dialog").close();
      };

      // open.onclick = (e) => {
      //   const href = e.currentTarget.getAttribute("href");
      //   // console.log(href);
      //   window.open(`${href}`, "_blank");
      // };

      // function favDialogClick(e) {
      //   console.log(this);
      //   e.target.closest("dialog").close();
      // }
      let showFlag = false;
      const wrap = document.querySelector(".wrap");
      const toggleBtn = document.querySelector(".toggle-button");

      const wrapWidth = wrap.getBoundingClientRect().width;

      toggleBtn.onclick = () => {
        showFlag = !showFlag;
        if (!showFlag) {
          toggleBtn.classList.remove("active");
          wrap.style.height = 35 + "px";
          //   wrap.style.transform = "translateX(+100%)";
        } else {
          toggleBtn.classList.add("active");
          wrap.style.height = 300 + "px";
          //   wrap.style.transform = "translateX(0%)";
        }
      };

      const CANVAS = document.querySelector(".canvas-background"),
        CTX = CANVAS.getContext("2d"),
        W = window.innerWidth,
        H = window.innerHeight,
        XO = W / 2,
        YO = H / 2,
        NUM_PARTICLES = 400,
        MAX_Z = 2,
        MAX_R = 1,
        Z_SPD = 1,
        PARTICLES = [];

      class Particle {
        constructor(x, y, z) {
          this.pos = new Vector(x, y, z);
          const X_VEL = 0,
            Y_VEL = 0,
            Z_VEL = -Z_SPD;
          this.vel = new Vector(X_VEL, Y_VEL, Z_VEL);
          this.vel.scale(0.005);
          this.fill = "rgba(255,255,255,0.3)";
          this.stroke = this.fill;
        }

        update() {
          this.pos.add(this.vel);
        }

        render() {
          const PIXEL = to2d(this.pos),
            X = PIXEL[0],
            Y = PIXEL[1],
            R = ((MAX_Z - this.pos.z) / MAX_Z) * MAX_R;

          if (X < 0 || X > W || Y < 0 || Y > H) this.pos.z = MAX_Z;

          this.update();
          CTX.beginPath();
          CTX.fillStyle = this.fill;
          CTX.strokeStyle = this.stroke;
          CTX.arc(X, PIXEL[1], R, 0, Math.PI * 2);
          CTX.fill();
          CTX.stroke();
          CTX.closePath();
        }
      }

      class Vector {
        constructor(x, y, z) {
          this.x = x;
          this.y = y;
          this.z = z;
        }

        add(v) {
          this.x += v.x;
          this.y += v.y;
          this.z += v.z;
        }

        scale(n) {
          this.x *= n;
          this.y *= n;
          this.z *= n;
        }
      }

      function to2d(v) {
        const X_COORD = v.x - XO,
          Y_COORD = v.y - YO,
          PX = X_COORD / v.z,
          PY = Y_COORD / v.z;
        return [PX + XO, PY + YO];
      }

      function render() {
        for (let i = 0; i < PARTICLES.length; i++) {
          PARTICLES[i].render();
        }
      }

      function loop() {
        requestAnimationFrame(loop);
        CTX.fillStyle = "rgba(0,0,0,0.15)";
        CTX.fillRect(0, 0, W, H);
        render();
      }

      function createParticles() {
        for (let i = 0; i < NUM_PARTICLES; i++) {
          const X = Math.random() * W,
            Y = Math.random() * H,
            Z = Math.random() * MAX_Z;
          PARTICLES.push(new Particle(X, Y, Z));
        }
      }

      function init() {
        CANVAS.width = W;
        CANVAS.height = H;
        createParticles();
        loop();
      }
      init();
    </script>
  </body>
</html>
